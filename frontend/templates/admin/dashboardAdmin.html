<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de control</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700;900&family=Work+Sans:wght@400;500;700;900&display=swap" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

  <!-- Corregir rutas CSS -->
  <link rel="stylesheet" href="/static/css/admin/dashboardAdmin.css">
  <link rel="stylesheet" href="/static/css/admin/sidebarAdmin.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* Estilos de respaldo en caso de que los archivos CSS no carguen */
    .admin-sidebar {
      background-color: #363636;
      color: white;
      width: 250px;
      min-height: 100vh;
    }

    .card {
      background: white;
      border: 1px solid #d1bc97;
      padding: 1.5rem;
      border-radius: 0.75rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body class="bg-[#fdfbf3] font-['Work_Sans','Noto_Sans',sans-serif]">
  <div class="relative flex min-h-screen w-full flex-col overflow-x-hidden">
    <div class="flex h-full w-full flex-1">

      <!-- Sidebar unificado -->
      <aside class="admin-sidebar">
        <div class="sidebar-container">
          <div class="sidebar-header">
            <h1 class="sidebar-title">Meraki</h1>
            <nav class="sidebar-nav">
              <a class="nav-item active" href="/dashboard">
                <span class="material-symbols-outlined">home</span>
                <p>Inicio</p>
              </a>
              <a class="nav-item" href="/pedidos">
                <span class="material-symbols-outlined">package_2</span>
                <p>Pedidos</p>
              </a>
              <a class="nav-item" href="/productos">
                <span class="material-symbols-outlined">list_alt</span>
                <p>Productos</p>
              </a>
              <a class="nav-item" href="/categorias">
                <span class="material-symbols-outlined">category</span>
                <p>Categorías</p>
              </a>
              <a class="nav-item" href="/clientes">
                <span class="material-symbols-outlined">group</span>
                <p>Clientes</p>
              </a>
            </nav>
          </div>
          <div class="sidebar-footer">
            <a class="nav-item" href="/auth/logout">
              <span class="material-symbols-outlined">logout</span>
              <p>Cerrar sesión</p>
            </a>
          </div>
        </div>
      </aside>

      <main class="flex-1 bg-[#fdfbf3]">
        <div class="p-6 md:p-8">
          <header class="mb-8">
            <h1 class="text-4xl font-bold text-[#363636]">Panel de control</h1>
          </header>

          <!-- Tarjetas de resumen -->
          <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
            <div class="card">
              <p class="text-[#9c642d] font-medium">Ventas totales</p>
              <h3 class="text-[#363636] font-bold text-2xl">${{ ventasTotales }}</h3>
              <div class="text-green-500 flex items-center text-sm">
                <span class="material-symbols-outlined text-base mr-1">arrow_upward</span>
                Este mes
              </div>
            </div>
            <div class="card">
              <p class="text-[#9c642d] font-medium">Pedidos recientes</p>
              <h3 class="text-[#363636] font-bold text-2xl">{{ pedidosRecientesCount }}</h3>
              <div class="text-green-500 flex items-center text-sm">
                <span class="material-symbols-outlined text-base mr-1">arrow_upward</span>
                Últimos 7 días
              </div>
            </div>
            <div class="card">
              <p class="text-[#9c642d] font-medium">Producto más vendido</p>
              <h3 class="text-[#363636] font-bold text-2xl">{{ productoMasVendido }}</h3>
              <div class="text-green-500 flex items-center text-sm">
                <span class="material-symbols-outlined text-base mr-1">arrow_upward</span>
                Destacado
              </div>
            </div>
            <div class="card">
              <p class="text-[#9c642d] font-medium">Clientes activos</p>
              <h3 class="text-[#363636] font-bold text-2xl">{{ clientesActivos }}</h3>
              <div class="text-green-500 flex items-center text-sm">
                <span class="material-symbols-outlined text-base mr-1">arrow_upward</span>
                Total activos
              </div>
            </div>
          </div>

          <div class="mt-8 grid grid-cols-1 gap-8 lg:grid-cols-3">
            <div class="lg:col-span-2">
              <div class="panel">
                <h2 class="text-xl font-bold text-[#363636] mb-4">Ventas Mensuales</h2>
                <p class="text-4xl font-bold text-[#363636]">${{ ventasTotales }}</p>
                <p class="text-[#9c642d]">Este mes</p>
                <div class="mt-4 h-64"><canvas id="ventasChart"></canvas></div>
              </div>
            </div>

            <div class="panel">
              <h2 class="text-xl font-bold text-[#363636] mb-4">Productos más vendidos</h2>
              <table class="w-full text-left">
                <thead class="border-b border-[#d1bc97]">
                  <tr>
                    <th class="pb-2 font-medium text-[#363636]">Producto</th>
                    <th class="pb-2 font-medium text-[#363636]">Ventas</th>
                    <th class="pb-2 font-medium text-[#363636]">Ingresos</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-[#d1bc97]">
                  {% for producto in productosMasVendidos %}
                  <tr>
                    <td class="py-2 text-[#363636]">{{ producto.nombre }}</td>
                    <td class="py-2 text-[#363636]">{{ producto.totalVendido }}</td>
                    <td class="py-2 text-[#363636]">${{ producto.ingresosTotales }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>

          <div class="mt-8 panel">
            <h2 class="text-xl font-bold text-[#363636] mb-4">Pedidos recientes</h2>
            <table class="w-full text-left">
              <thead class="border-b border-[#d1bc97]">
                <tr>
                  <th class="pb-2 font-medium text-[#363636]">ID</th>
                  <th class="pb-2 font-medium text-[#363636]">Cliente</th>
                  <th class="pb-2 font-medium text-[#363636]">Fecha</th>
                  <th class="pb-2 font-medium text-[#363636]">Estado</th>
                  <th class="pb-2 font-medium text-[#363636] text-right">Total</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-[#d1bc97]">
                {% for pedido in pedidosRecientes %}
                <tr>
                  <td class="py-2 text-[#363636]">#{{ pedido.id }}</td>
                  <td class="py-2 text-[#363636]">{{ pedido.clienteNombre }}</td>
                  <td class="py-2 text-[#363636]">{{ pedido.fecha }}</td>
                  <td class="py-2">
                    {% if pedido.estado in ['PAGADO', 'ENVIADO'] %}
                    <span class="estado azul">{{ pedido.estado }}</span>
                    {% elif pedido.estado == 'ENTREGADO' %}
                    <span class="estado verde">{{ pedido.estado }}</span>
                    {% elif pedido.estado == 'PENDIENTE' %}
                    <span class="estado amarillo">{{ pedido.estado }}</span>
                    {% else %}
                    <span class="estado rojo">{{ pedido.estado }}</span>
                    {% endif %}
                  </td>
                  <td class="py-2 text-[#363636] text-right">${{ pedido.total }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Script para pasar datos de Python a JavaScript -->
  <script>
    // Datos para la gráfica - con manejo de error si no existen
    const datosGrafica = JSON.parse(`{{ datosGrafica | default({}, true) | tojson }}`);

    // Si no hay datos, crear estructura vacía
    if (!datosGrafica.meses || !datosGrafica.ventas) {
      window.datosGrafica = {
        meses: [],
        ventas: []
      };
    } else {
      window.datosGrafica = datosGrafica;
    }

    console.log('Datos de gráfica cargados:', window.datosGrafica);
  </script>

  <!-- Corregir ruta del JS -->
  <script src="/static/js/admin/dashboardAdmin.js"></script>
</body>

</html>